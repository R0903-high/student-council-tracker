<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁîüÂæí‰ºö„Çø„Çπ„ÇØÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // SVG„Ç¢„Ç§„Ç≥„É≥„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà
        const RefreshIcon = ({ className, spin }) => (
            <svg className={className + (spin ? ' animate-spin' : '')} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
        );

        const ExternalLinkIcon = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
            </svg>
        );

        const ClockIcon = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const AlertIcon = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const StudentCouncilTracker = () => {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [password, setPassword] = useState('');
            const [passwordError, setPasswordError] = useState(false);
            const [tasks, setTasks] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [lastUpdated, setLastUpdated] = useState(null);
            const [filterStatus, setFilterStatus] = useState('all');
            const [sortOrder, setSortOrder] = useState('desc');

            // „Éë„Çπ„ÉØ„Éº„ÉâË®≠ÂÆö
            const CORRECT_PASSWORD = 'seitokai2025';

            const handleLogin = (e) => {
                e.preventDefault();
                if (password === CORRECT_PASSWORD) {
                    setIsAuthenticated(true);
                    setPasswordError(false);
                    sessionStorage.setItem('auth', 'true');
                } else {
                    setPasswordError(true);
                }
            };

            useEffect(() => {
                const auth = sessionStorage.getItem('auth');
                if (auth === 'true') {
                    setIsAuthenticated(true);
                }
            }, []);

            useEffect(() => {
                if (isAuthenticated) {
                    loadData();
                }
            }, [isAuthenticated]);

            const loadData = async () => {
                setLoading(true);
                setError(null);
                
                try {
                    const response = await fetch('https://script.google.com/macros/s/AKfycby2vNpYa55_u_u-OR8mP9oDRbZIjGVtSzWhTJ3zlwA-F4G3UpKGU6uKvPBv8pNBRZZa/exec');
                    
                    if (!response.ok) {
                        throw new Error('„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                    }
                    
                    const data = await response.json();
                    console.log('ÂèñÂæó„Åó„Åü„Éá„Éº„Çø:', data); // „Éá„Éê„ÉÉ„Ç∞Áî®
                    console.log('„Éá„Éº„Çø‰ª∂Êï∞:', data.length);
                    if (data.length > 0) {
                        console.log('ÊúÄÂàù„ÅÆ„Çø„Çπ„ÇØ:', data[0]);
                    }
                    setTasks(data);
                    setLastUpdated(new Date().toLocaleString('ja-JP'));
                    setError(null);
                } catch (err) {
                    console.error('Error loading data:', err);
                    setError('„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Åó„Å∞„Çâ„Åè„Åó„Å¶„Åã„ÇâÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
                } finally {
                    setLoading(false);
                }
            };

            const getStatusColor = (status) => {
                const colors = {
                    'Êú™ÁùÄÊâã': 'bg-slate-100 text-slate-800 border-slate-300',
                    'ÂèØÊ±∫': 'bg-green-100 text-green-800 border-green-300',
                    'Âê¶Ê±∫': 'bg-red-100 text-red-800 border-red-300',
                    'Ê§úË®é‰∏≠': 'bg-blue-100 text-blue-800 border-blue-300',
                    'ÂØ©Ë≠∞‰∏≠': 'bg-yellow-100 text-yellow-800 border-yellow-300',
                    '‰øùÁïô': 'bg-gray-100 text-gray-800 border-gray-300',
                    'ÈÄ≤Ë°å‰∏≠': 'bg-purple-100 text-purple-800 border-purple-300',
                    'ÂÆå‰∫Ü': 'bg-emerald-100 text-emerald-800 border-emerald-300'
                };
                return colors[status] || 'bg-gray-100 text-gray-800 border-gray-300';
            };

            const getFilteredAndSortedTasks = () => {
                let filtered = tasks;
                
                if (filterStatus !== 'all') {
                    filtered = tasks.filter(task => task.status === filterStatus);
                }
                
                const sorted = [...filtered].sort((a, b) => {
                    const dateA = new Date(a.updated || 0);
                    const dateB = new Date(b.updated || 0);
                    return sortOrder === 'desc' ? dateB - dateA : dateA - dateB;
                });
                
                return sorted;
            };

            const isValidUrl = (url) => {
                if (!url) return false;
                const trimmed = String(url).trim();
                if (trimmed === '') return false;
                if (trimmed === 'https://example.com' || trimmed === 'http://example.com' || 
                    trimmed.startsWith('https://example.com/') || trimmed.startsWith('http://example.com/')) return false;
                try {
                    new URL(trimmed);
                    return true;
                } catch {
                    return false;
                }
            };

            const displayedTasks = getFilteredAndSortedTasks();

            // „É≠„Ç∞„Ç§„É≥ÁîªÈù¢
            if (!isAuthenticated) {
                return (
                    <div style={{minHeight: '100vh', background: 'linear-gradient(to bottom right, #eff6ff, #e0e7ff)', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '1rem'}}>
                        <div style={{background: 'white', borderRadius: '0.5rem', boxShadow: '0 20px 25px -5px rgba(0, 0, 0, 0.1)', padding: '2rem', width: '100%', maxWidth: '28rem'}}>
                            <div style={{display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: '1.5rem'}}>
                                <div style={{background: '#4f46e5', padding: '0.75rem', borderRadius: '9999px', width: '64px', height: '64px', display: 'flex', alignItems: 'center', justifyContent: 'center'}}>
                                    <svg style={{width: '32px', height: '32px', color: 'white'}} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                    </svg>
                                </div>
                            </div>
                            <h1 style={{fontSize: '1.5rem', fontWeight: 'bold', textAlign: 'center', marginBottom: '0.5rem', color: '#1f2937'}}>
                                ÁîüÂæí‰ºö„Çø„Çπ„ÇØÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†
                            </h1>
                            <p style={{textAlign: 'center', color: '#4b5563', marginBottom: '1.5rem'}}>
                                „Ç¢„ÇØ„Çª„Çπ„Å´„ÅØ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÂøÖË¶Å„Åß„Åô
                            </p>
                            <form onSubmit={handleLogin}>
                                <div style={{marginBottom: '1rem'}}>
                                    <label style={{display: 'block', fontSize: '0.875rem', fontWeight: '500', color: '#374151', marginBottom: '0.5rem'}}>
                                        „Éë„Çπ„ÉØ„Éº„Éâ
                                    </label>
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => {
                                            setPassword(e.target.value);
                                            setPasswordError(false);
                                        }}
                                        style={{
                                            width: '100%', 
                                            padding: '0.5rem 1rem', 
                                            border: passwordError ? '1px solid #ef4444' : '1px solid #d1d5db',
                                            borderRadius: '0.5rem',
                                            outline: 'none'
                                        }}
                                        placeholder="„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ"
                                    />
                                    {passwordError && (
                                        <p style={{marginTop: '0.5rem', fontSize: '0.875rem', color: '#dc2626'}}>
                                            „Éë„Çπ„ÉØ„Éº„Éâ„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì
                                        </p>
                                    )}
                                </div>
                                <button
                                    type="submit"
                                    style={{width: '100%', background: '#4f46e5', color: 'white', padding: '0.5rem', borderRadius: '0.5rem', fontWeight: '500', border: 'none', cursor: 'pointer'}}
                                >
                                    „É≠„Ç∞„Ç§„É≥
                                </button>
                            </form>
                            <p style={{marginTop: '1.5rem', fontSize: '0.75rem', textAlign: 'center', color: '#6b7280'}}>
                                „Éë„Çπ„ÉØ„Éº„Éâ„ÅØÁîüÂæí‰ºö„Åã„ÇâÈÖçÂ∏É„Åï„Çå„Å¶„ÅÑ„Åæ„Åô
                            </p>
                        </div>
                    </div>
                );
            }

            // „É°„Ç§„É≥ÁîªÈù¢
            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-2 sm:p-4">
                    <div className="max-w-6xl mx-auto">
                        {/* „Éò„ÉÉ„ÉÄ„Éº */}
                        <div className="bg-white rounded-lg shadow-lg p-4 sm:p-6 mb-4">
                            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                                <div>
                                    <h1 className="text-2xl sm:text-3xl font-bold text-gray-800">
                                        ÁîüÂæí‰ºö„Çø„Çπ„ÇØÁÆ°ÁêÜ
                                    </h1>
                                    <p className="text-sm text-gray-600 mt-1">
                                        ÁîüÂæí‰ºö„ÅÆÊ¥ªÂãïÁä∂Ê≥Å„ÇíÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô
                                    </p>
                                </div>
                                <button
                                    onClick={loadData}
                                    disabled={loading}
                                    className="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    <RefreshIcon className="w-4 h-4" spin={loading} />
                                    <span>Êõ¥Êñ∞</span>
                                </button>
                            </div>
                            
                            {lastUpdated && (
                                <div className="flex items-center gap-2 mt-4 text-sm text-gray-600">
                                    <ClockIcon className="w-4 h-4" />
                                    <span>ÊúÄÁµÇÊõ¥Êñ∞: {lastUpdated}</span>
                                </div>
                            )}

                            {/* „Éï„Ç£„É´„Çø„ÉºÔºÜ„ÇΩ„Éº„Éà */}
                            <div className="mt-4 pt-4 border-t border-gray-200">
                                <div className="flex flex-col sm:flex-row gap-3">
                                    {/* „Çπ„ÉÜ„Éº„Çø„Çπ„Éï„Ç£„É´„Çø„Éº */}
                                    <div className="flex-1">
                                        <label className="block text-xs font-medium text-gray-700 mb-1">
                                            „Çπ„ÉÜ„Éº„Çø„Çπ„ÅßÁµû„ÇäËæº„Åø
                                        </label>
                                        <select
                                            value={filterStatus}
                                            onChange={(e) => setFilterStatus(e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                        >
                                            <option value="all">„Åô„Åπ„Å¶Ë°®Á§∫</option>
                                            <option value="Ê§úË®é‰∏≠">Ê§úË®é‰∏≠„ÅÆ„Åø</option>
                                            <option value="ÂØ©Ë≠∞‰∏≠">ÂØ©Ë≠∞‰∏≠„ÅÆ„Åø</option>
                                            <option value="ÈÄ≤Ë°å‰∏≠">ÈÄ≤Ë°å‰∏≠„ÅÆ„Åø</option>
                                            <option value="ÂèØÊ±∫">ÂèØÊ±∫„ÅÆ„Åø</option>
                                            <option value="Âê¶Ê±∫">Âê¶Ê±∫„ÅÆ„Åø</option>
                                            <option value="‰øùÁïô">‰øùÁïô„ÅÆ„Åø</option>
                                            <option value="ÂÆå‰∫Ü">ÂÆå‰∫Ü„ÅÆ„Åø</option>
                                            <option value="Êú™ÁùÄÊâã">Êú™ÁùÄÊâã„ÅÆ„Åø</option>
                                        </select>
                                    </div>

                                    {/* Êó•‰ªò„ÇΩ„Éº„Éà */}
                                    <div className="flex-1">
                                        <label className="block text-xs font-medium text-gray-700 mb-1">
                                            ‰∏¶„Å≥È†Ü
                                        </label>
                                        <select
                                            value={sortOrder}
                                            onChange={(e) => setSortOrder(e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                        >
                                            <option value="desc">Êñ∞„Åó„ÅÑÈ†Ü</option>
                                            <option value="asc">Âè§„ÅÑÈ†Ü</option>
                                        </select>
                                    </div>
                                </div>

                                {/* Ë°®Á§∫‰ª∂Êï∞ */}
                                <div className="mt-3 text-sm text-gray-600">
                                    {displayedTasks.length}‰ª∂„ÅÆ„Çø„Çπ„ÇØ„ÇíË°®Á§∫‰∏≠
                                    {filterStatus !== 'all' && ` (${filterStatus})`}
                                </div>
                            </div>
                        </div>

                        {/* „Çø„Çπ„ÇØ„É™„Çπ„Éà */}
                        {loading ? (
                            <div className="bg-white rounded-lg shadow-lg p-8 text-center">
                                <RefreshIcon className="w-8 h-8 mx-auto mb-4 text-indigo-600" spin={true} />
                                <p className="text-gray-600">Ë™≠„ÅøËæº„Åø‰∏≠...</p>
                            </div>
                        ) : error ? (
                            <div className="bg-white rounded-lg shadow-lg p-8">
                                <div className="flex items-center gap-3 text-red-600 mb-4">
                                    <AlertIcon className="w-6 h-6" />
                                    <p className="font-medium">„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü</p>
                                </div>
                                <p className="text-gray-600">{error}</p>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                {displayedTasks.length === 0 ? (
                                    <div className="bg-white rounded-lg shadow-lg p-8 text-center">
                                        <p className="text-gray-600">
                                            {filterStatus !== 'all' 
                                                ? `${filterStatus}„ÅÆ„Çø„Çπ„ÇØ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì` 
                                                : '„Çø„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì'}
                                        </p>
                                    </div>
                                ) : (
                                    displayedTasks.map((task, index) => (
                                    <div
                                        key={task.id || index}
                                        className="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow overflow-hidden"
                                    >
                                        <div className="flex flex-col sm:flex-row">
                                            {/* Â∑¶ÂÅ¥ÔºöÁ¥´„ÅÆ„Çµ„Ç§„Éâ„Éê„Éº„Å®„Çø„Çπ„ÇØID */}
                                            <div className="bg-gradient-to-b from-purple-600 to-indigo-600 p-4 sm:w-32 flex sm:flex-col items-center justify-center">
                                                <div className="text-center">
                                                    <div className="text-white text-xs font-semibold mb-1">TASK ID</div>
                                                    <div className="bg-white bg-opacity-20 rounded-lg px-3 py-2">
                                                        <span className="text-white font-mono font-bold text-lg">
                                                            {task.id}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* ‰∏≠Â§ÆÔºö„Çø„Çπ„ÇØÊÉÖÂ†± */}
                                            <div className="flex-grow p-4">
                                                {/* „Ç´„ÉÜ„Ç¥„É™„Éê„ÉÉ„Ç∏ */}
                                                {task.category && (
                                                    <div className="mb-2">
                                                        <span className="inline-block bg-blue-50 text-blue-700 text-xs font-semibold px-3 py-1 rounded-full border border-blue-200">
                                                            üìÅ {task.category}
                                                        </span>
                                                    </div>
                                                )}
                                                
                                                {/* „Çø„Çπ„ÇØÂêç */}
                                                <h3 className="font-bold text-gray-800 text-lg mb-2">
                                                    {task.name}
                                                </h3>
                                                
                                                {/* „Çø„Çπ„ÇØË©≥Á¥∞ */}
                                                {task.detail && (
                                                    <p className="text-sm text-gray-600 mb-3 leading-relaxed">
                                                        {task.detail}
                                                    </p>
                                                )}
                                                
                                                {/* „Çπ„ÉÜ„Éº„Çø„Çπ„Å®Êõ¥Êñ∞Êó•ÊôÇ */}
                                                <div className="flex flex-wrap items-center gap-3">
                                                    <span className={`px-3 py-1 rounded-full font-medium text-sm border ${getStatusColor(task.status)}`}>
                                                        {task.status}
                                                    </span>
                                                    
                                                    {task.updated && (
                                                        <div className="flex items-center gap-1 text-xs text-gray-500">
                                                            <ClockIcon className="w-3 h-3" />
                                                            <span>{task.updated}</span>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>

                                            {/* Âè≥ÂÅ¥ÔºöË©≥Á¥∞„Éú„Çø„É≥ */}
                                            {isValidUrl(task.url) && (
                                                <div className="p-4 flex items-center justify-center border-t sm:border-t-0 sm:border-l border-gray-100">
                                                    <a
                                                        href={task.url}
                                                        target="_blank"
                                                        rel="noopener noreferrer"
                                                        className="inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors text-sm font-medium shadow-sm"
                                                    >
                                                        <span>Ë©≥Á¥∞„ÇíË¶ã„Çã</span>
                                                        <ExternalLinkIcon className="w-4 h-4" />
                                                    </a>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                )))}
                            </div>
                        )}

                        {/* „Éï„ÉÉ„Çø„Éº */}
                        <div className="mt-6 text-center text-sm text-gray-600">
                            <p>ÁîüÂæí‰ºö„Å∏„ÅÆ„ÅîÊÑèË¶ã„Éª„ÅîË≥™Âïè„ÅØÁîüÂæí‰ºöÂÆ§„Åæ„Åß„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô</p>
                        </div>
                    </div>
                </div>
            );
        };

        // „Ç¢„Éó„É™„Çí„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<StudentCouncilTracker />);
    </script>
</body>
</html>
